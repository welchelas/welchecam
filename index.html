<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>C치mara con Cambio Funcional</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      width: 100%;
      max-width: 800px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .header {
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #ff9900;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: #ff9900;
    }
    
    .instructions {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 10px;
    }
    
    .camera-container {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* Relaci칩n 16:9 */
      overflow: hidden;
    }
    
    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #000;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.8);
    }
    
    .btn {
      background: linear-gradient(to bottom, #ff9900, #ff6600);
      color: white;
      border: none;
      padding: 14px 25px;
      border-radius: 50px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      background: linear-gradient(to bottom, #ffbb33, #ff7733);
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    .btn:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .status {
      text-align: center;
      padding: 15px;
      font-size: 16px;
      background: rgba(0, 0, 0, 0.6);
      border-top: 1px solid #333;
    }
    
    .error {
      color: #ff6666;
      text-align: center;
      padding: 15px;
      display: none;
    }
    
    .camera-icon {
      width: 20px;
      height: 20px;
    }
    
    .footer {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
      opacity: 0.8;
    }
    
    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
      }
      
      h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>游닝 Control de C치mara</h1>
      <p class="instructions">Haz clic en "Cambiar C치mara" para alternar entre la c치mara frontal y trasera</p>
    </div>
    
    <div class="camera-container">
      <video id="video" autoplay playsinline></video>
    </div>
    
    <div class="error" id="errorMsg"></div>
    
    <div class="status" id="status">C치mara trasera activada</div>
    
    <div class="controls">
      <button id="switchBtn" class="btn">
        <svg class="camera-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z" stroke="currentColor" stroke-width="2"/>
          <path d="M2 12C2 12 5.5 7 12 7C18.5 7 22 12 22 12C22 12 18.5 17 12 17C5.5 17 2 12 2 12Z" stroke="currentColor" stroke-width="2"/>
        </svg>
        CAMBIAR C츼MARA
      </button>
      <button id="captureBtn" class="btn">
        <svg class="camera-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 10.5V18.9C21 19.46 20.78 20 20.38 20.41C20.17 20.62 19.92 20.78 19.64 20.88C19.36 20.98 19.06 21.03 18.76 21H5.24C4.68 21 4.14 20.78 3.73 20.38C3.32 19.97 3.1 19.43 3.1 18.87V10.5" stroke="currentColor" stroke-width="2"/>
          <path d="M16.5 7.5H15.6C15.3 7.5 15 7.3 14.9 7.1L14.1 5.4C14 5.2 13.7 5 13.4 5H10.6C10.3 5 10 5.2 9.9 5.4L9.1 7.1C9 7.3 8.7 7.5 8.4 7.5H7.5C6.4 7.5 5.5 8.4 5.5 9.5V11.5C5.5 12.6 6.4 13.5 7.5 13.5H16.5C17.6 13.5 18.5 12.6 18.5 11.5V9.5C18.5 8.4 17.6 7.5 16.5 7.5Z" stroke="currentColor" stroke-width="2"/>
          <path d="M12 11.5C12.5523 11.5 13 11.0523 13 10.5C13 9.94772 12.5523 9.5 12 9.5C11.4477 9.5 11 9.94772 11 10.5C11 11.0523 11.4477 11.5 12 11.5Z" stroke="currentColor" stroke-width="2"/>
        </svg>
        CAPTURAR FOTO
      </button>
    </div>
  </div>
  
  <div class="footer">
    <p>Esta aplicaci칩n funciona en la mayor칤a de navegadores modernos</p>
  </div>

  <script>
    const video = document.getElementById('video');
    const switchBtn = document.getElementById('switchBtn');
    const captureBtn = document.getElementById('captureBtn');
    const statusDisplay = document.getElementById('status');
    const errorMsg = document.getElementById('errorMsg');
    
    let stream = null;
    let availableCameras = [];
    let currentCameraIndex = 0;
    let isFrontCameraAvailable = false;
    let isBackCameraAvailable = false;

    // Detectar dispositivos y c치maras disponibles
    async function setupCameras() {
      try {
        // Primero solicitar permisos con una configuraci칩n b치sica
        const tempStream = await navigator.mediaDevices.getUserMedia({ 
          video: true,
          audio: false 
        });
        
        // Detener el stream temporal
        tempStream.getTracks().forEach(track => track.stop());
        
        // Enumerar dispositivos
        const devices = await navigator.mediaDevices.enumerateDevices();
        availableCameras = devices.filter(device => device.kind === 'videoinput');
        
        console.log('C치maras disponibles:', availableCameras);
        
        // Detectar tipos de c치maras disponibles
        if (availableCameras.length > 0) {
          // Para dispositivos m칩viles, intentar determinar qu칠 c치maras hay disponibles
          if (isMobileDevice()) {
            // Probar c치mara trasera
            try {
              const backStream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
              });
              backStream.getTracks().forEach(track => track.stop());
              isBackCameraAvailable = true;
            } catch (e) {
              console.log("C치mara trasera no disponible");
            }
            
            // Probar c치mara frontal
            try {
              const frontStream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'user' }
              });
              frontStream.getTracks().forEach(track => track.stop());
              isFrontCameraAvailable = true;
            } catch (e) {
              console.log("C치mara frontal no disponible");
            }
          }
          
          // Si no se detectaron c치maras con facingMode, asumir que la primera es trasera y la segunda frontal
          if (!isBackCameraAvailable && !isFrontCameraAvailable) {
            if (availableCameras.length >= 1) isBackCameraAvailable = true;
            if (availableCameras.length >= 2) isFrontCameraAvailable = true;
          }
        }
        
        // Actualizar interfaz seg칰n las c치maras disponibles
        if (availableCameras.length < 2) {
          switchBtn.disabled = true;
          switchBtn.innerHTML = "SOLO 1 C츼MARA DISPONIBLE";
          statusDisplay.textContent = availableCameras.length === 1 ? 
            'Solo una c치mara disponible' : 'No se detectaron c치maras';
        } else {
          switchBtn.disabled = false;
        }
        
        // Iniciar con la c치mara preferida
        startCamera();
        
      } catch (error) {
        console.error("Error al configurar c치maras:", error);
        showError("Error al acceder a la c치mara. Aseg칰rate de permitir el acceso.");
      }
    }

    // Iniciar c치mara
    async function startCamera() {
      // Detener stream actual si existe
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }

      try {
        // Para dispositivos m칩viles con facingMode disponible
        if (isMobileDevice() && (isFrontCameraAvailable || isBackCameraAvailable)) {
          // Alternar entre frontal y trasera
          const facingMode = (currentCameraIndex % 2 === 0) ? 'environment' : 'user';
          
          // Verificar que la c치mara seleccionada est칠 disponible
          if ((facingMode === 'environment' && !isBackCameraAvailable) || 
              (facingMode === 'user' && !isFrontCameraAvailable)) {
            // Cambiar al otro modo si el seleccionado no est치 disponible
            currentCameraIndex = (currentCameraIndex + 1) % 2;
            return startCamera();
          }
          
          const constraints = {
            video: { 
              facingMode: facingMode,
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          };
          
          stream = await navigator.mediaDevices.getUserMedia(constraints);
          statusDisplay.textContent = facingMode === 'environment' ? 
            'C치mara trasera activada' : 'C치mara frontal activada';
        } 
        // Para desktop con m칰ltiples c치maras
        else if (availableCameras.length > 0) {
          const constraints = {
            video: { 
              deviceId: { exact: availableCameras[currentCameraIndex].deviceId },
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          };
          
          stream = await navigator.mediaDevices.getUserMedia(constraints);
          statusDisplay.textContent = `C치mara ${currentCameraIndex + 1} de ${availableCameras.length}`;
        } else {
          throw new Error("No hay c치maras disponibles");
        }
        
        video.srcObject = stream;
        errorMsg.style.display = 'none';
        
      } catch (err) {
        console.error("Error al acceder a la c치mara:", err);
        showError("No se pudo acceder a la c치mara. Intenta recargar la p치gina.");
        
        // Si falla, intentar con la siguiente c치mara
        if (availableCameras.length > 1) {
          currentCameraIndex = (currentCameraIndex + 1) % availableCameras.length;
          setTimeout(startCamera, 1000);
        }
      }
    }

    // Cambiar entre c치maras
    switchBtn.addEventListener('click', () => {
      if (isMobileDevice() && (isFrontCameraAvailable || isBackCameraAvailable)) {
        // En m칩viles: alternar entre frontal y trasera
        currentCameraIndex = (currentCameraIndex + 1) % 2;
      } else {
        // En desktop: ciclo a trav칠s de todas las c치maras disponibles
        currentCameraIndex = (currentCameraIndex + 1) % availableCameras.length;
      }
      
      startCamera();
    });

    // Capturar foto
    captureBtn.addEventListener('click', () => {
      try {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // Crear un enlace para descargar la imagen
        const link = document.createElement('a');
        link.download = 'foto.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        // Efecto visual de captura
        video.style.opacity = '0.5';
        setTimeout(() => {
          video.style.opacity = '1';
        }, 200);
        
      } catch (error) {
        console.error("Error al capturar foto:", error);
        showError("Error al capturar la foto");
      }
    });

    // Mostrar mensaje de error
    function showError(message) {
      errorMsg.textContent = message;
      errorMsg.style.display = 'block';
    }

    // Detectar si es dispositivo m칩vil
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // Inicializar cuando la p치gina cargue
    window.addEventListener('load', setupCameras);
  </script>
</body>
</html>
