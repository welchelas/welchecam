async function startCamera() {
  if (stream) {
    stream.getTracks().forEach(track => track.stop()); // Para el stream actual si existe
  }
  try {
    const newStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: currentFacingMode },
      audio: true
    });
    // Transición suave
    video.style.opacity = 0;
    setTimeout(() => {
      video.srcObject = newStream;
      video.play();
      video.style.opacity = 1;
    }, 300);
    stream = newStream;
    // Configura el micrófono según si está silenciado o no
    const audioTrack = stream.getAudioTracks()[0];
    if (audioTrack) audioTrack.enabled = !isMuted;
  } catch (err) {
    alert("Error al acceder a la cámara: " + err.message);
  }
}

switchBtn.addEventListener('click', async () => {
  currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
  await startCamera();
});
